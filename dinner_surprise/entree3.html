<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Employee Access Terminal</title>
  <style>
    :root{
      --bg:#0e141b; --panel:#141c25; --border:#2a3a4a;
      --text:#e8f0ff; --muted:#9fb2c8; --accent: rgba(53,194,255,.45);
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 18px; --radius2: 14px;
      --font: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      --green: rgba(80, 255, 160, .95);
    }
    html, body{margin:0;padding:0;width:100%;height:100%;overflow:visible;
      background: radial-gradient(1200px 800px at 30% 20%, #162131 0%, var(--bg) 60%);
      color:var(--text);font-family:var(--font);user-select:none;touch-action: manipulation;`r`n      overscroll-behavior: none;}
    .app{width:100%;height:100%;padding:18px;box-sizing:border-box;display:grid;grid-template-rows:84px 1fr;gap:14px;}
    .topbar{display:flex;align-items:center;justify-content:space-between;background:linear-gradient(180deg,#182433 0%,#121a24 100%);
      border:1px solid var(--border);border-radius:var(--radius);padding:14px 18px;box-shadow:var(--shadow);}
    .brand{display:flex;align-items:center;gap:12px;}
    .logo{width:46px;height:46px;border-radius:14px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.10);
      display:flex;align-items:center;justify-content:center;font-size:24px;\r\n      font-family: "Apple Color Emoji","Segoe UI Emoji","Noto Color Emoji",sans-serif;}
    .brand h1{margin:0;font-size:22px;letter-spacing:.4px;}
    .brand .sub{margin-top:2px;font-size:13px;color:var(--muted);}
    .rightHeader{display:flex;align-items:center;gap:12px;}
    .pill{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);padding:8px 12px;border-radius:999px;font-size:13px;color:var(--muted);white-space:nowrap;}

    .progress{display:flex;align-items:center;gap:10px;padding:8px 12px;border-radius:999px;border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.035);box-shadow:inset 0 0 0 1px rgba(0,0,0,.22);}
    .dot{width:20px;height:20px;border-radius:999px;border:2px solid rgba(255,255,255,.16);
      background:radial-gradient(circle at 35% 30%, rgba(255,255,255,.14), rgba(255,255,255,.05));
      box-shadow:inset 0 0 0 2px rgba(0,0,0,.25);position:relative;}
    .dot::after{content:"";position:absolute;inset:5px;border-radius:999px;background:rgba(0,0,0,.25);box-shadow:inset 0 0 0 1px rgba(255,255,255,.06);}
    .dot.on{border-color:rgba(53,194,255,.75);box-shadow:0 0 0 4px rgba(53,194,255,.14),0 10px 18px rgba(0,0,0,.25),inset 0 0 0 2px rgba(0,0,0,.22);}
    .dot.on::after{
      background:
        radial-gradient(circle at 35% 30%, rgba(255,255,255,.65), rgba(255,255,255,.0) 45%),
        radial-gradient(circle at 50% 55%, var(--green), rgba(0,0,0,.10) 70%);
      box-shadow:0 0 14px rgba(80,255,160,.55), inset 0 0 0 1px rgba(255,255,255,.12);
    }

    .panel{background:linear-gradient(180deg,#141c25 0%,#101720 100%);border:1px solid var(--border);border-radius:var(--radius);
      box-shadow:var(--shadow);padding:18px;position:relative;display:flex;flex-direction:column;gap:16px;}
    .headerCard{background:linear-gradient(180deg, rgba(34,211,166,.14) 0%, rgba(255,255,255,.03) 70%);
      border:1px solid rgba(255,255,255,.08);border-radius:var(--radius2);padding:18px 20px;}
    .title{margin:0;font-size:30px;letter-spacing:.3px;}
    .hint{margin-top:10px;font-size:14px;color:var(--muted);}
    .grid{flex:1;display:grid;grid-template-columns:repeat(5,1fr);grid-template-rows:repeat(5,1fr);gap:12px;}
    .ingBtn{border-radius:18px;border:1px solid rgba(255,255,255,.10);background:linear-gradient(180deg, rgba(255,255,255,.06) 0%, rgba(255,255,255,.02) 100%);
      box-shadow:0 10px 22px rgba(0,0,0,.22);color:var(--text);font-size:18px;padding:14px;text-align:center;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:.12s;line-height:1.15;}
    .ingBtn:active{transform:translateY(1px);}
    .ingBtn.on{border-color:rgba(53,194,255,.70);background:linear-gradient(180deg, rgba(53,194,255,.22) 0%, rgba(255,255,255,.02) 100%);
      box-shadow:0 0 0 4px rgba(53,194,255,.14),0 10px 22px rgba(0,0,0,.22);}
    .status{min-height:22px;font-size:14px;color:var(--muted);padding-left:6px;}
    .status.ok{color:#7cf5d8;} .status.err{color:#ff8b8b;}
  </style>
</head>
<body>
<div class="app">
  <div class="topbar">
    <div class="brand">
      <div class="logo">&#x1F37D;&#xFE0F;</div>
      <div>
        <h1>Dining Room POS</h1>
        <div class="sub">Employee Access Terminal</div>
      </div>
    </div>
    <div class="rightHeader">
      <div class="progress" aria-label="progress">
        <div class="dot on" id="dot1"></div>
        <div class="dot on" id="dot2"></div>
        <div class="dot" id="dot3"></div>
      </div>
      <div class="pill">Touchscreen</div>
    </div>
  </div>

  <div class="panel">
    <div class="headerCard">
      <p class="title">Ocean Pearl Lobster</p>
      <p class="hint">Build an Entree</p>
    </div>

    <div class="grid" id="grid"></div>
    <div class="status" id="status">Select 5 ingredients.</div>
  </div>
</div>

<script>
(() => {
  const NODE_RED_URL = "http://192.168.1.50:1880/escape/event";
  const NEXT_PAGE = "roses.html";
  const NAV_DELAY_MS = 50;
  const PARTY_ROOM_BASE_URL = "http://192.168.1.123";
  const RELAY_ENDPOINT = PARTY_ROOM_BASE_URL + "/relay/3";
  const RELAY_TIMEOUT_MS = 1000;
  const RELAY_MAX_ATTEMPTS = 3;

  const ENTREE_TITLE = "Ocean Pearl Lobster";
  const CODE = new Set(["Lobster tail","Fennel bulb","Vanilla bean","Cream","Chives"]);

  // 25 total = 5 code + 20 companions (Page 3 companion set, different mix)
  const INGREDIENTS = [
    "Lobster tail","Fennel bulb","Vanilla bean","Cream","Chives",
    "Wild halibut","Veal tenderloin","Lamb rack","Ricotta","Arborio rice",
    "White asparagus","Zucchini blossom","Scallion","Ginger root","Mint leaf",
    "Lemon verbena","Sage","Cumin seed","Pomegranate molasses","Pine nut",
    "Cultured butter","Olive oil","Yogurt","Honey","Sea salt"
  ];

  function shuffle(arr){
    for(let i = arr.length - 1; i > 0; i--){
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }

  const gridEl = document.getElementById("grid");
  const statusEl = document.getElementById("status");
  const selected = new Set();
  let locked = false;

  function setStatus(t, k=""){
    statusEl.textContent = t;
    statusEl.className = "status" + (k ? " " + k : "");
  }

  function triggerNR(payload){
    try{
      fetch(NODE_RED_URL,{
        method:"POST",
        mode:"no-cors",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify(payload),
        keepalive:true
      });
    }catch{}
  }

  function goNext(){
    try { location.replace(NEXT_PAGE); }
    catch { location.href = NEXT_PAGE; }
  }

  async function postRelay3Once(){
    return new Promise((resolve, reject) => {
      const xhr = new XMLHttpRequest();
      xhr.open("POST", RELAY_ENDPOINT, true);
      xhr.timeout = RELAY_TIMEOUT_MS;

      xhr.onload = () => {
        if(xhr.status === 200){
          resolve(true);
          return;
        }
        reject(new Error("Unexpected status: " + xhr.status));
      };

      xhr.onerror = () => reject(new Error("Network error"));
      xhr.ontimeout = () => reject(new Error("Timeout"));
      xhr.send();
    });
  }

  async function triggerRelay3WithRetry(){
    for(let attempt = 1; attempt <= RELAY_MAX_ATTEMPTS; attempt++){
      try{
        const ok = await postRelay3Once();
        if(ok){
          return;
        }
      }catch{}
    }
  }

  function clearAll(){
    selected.clear();
    [...gridEl.children].forEach(b => b.classList.remove("on"));
  }

  function isCorrect(){
    if(selected.size !== 5) return false;
    for(const s of selected) if(!CODE.has(s)) return false;
    return true;
  }

  function toggle(label, btn){
    if(locked) return;

    if(selected.has(label)){
      selected.delete(label);
      btn.classList.remove("on");
      setStatus(`Selected ${selected.size}/5.`);
      return;
    }

    if(selected.size >= 5) return;

    selected.add(label);
    btn.classList.add("on");
    setStatus(`Selected ${selected.size}/5.`);

    if(selected.size === 5){
      if(isCorrect()){
        locked = true;
        setStatus("Correct recipe&#x2026;", "ok");

        triggerNR({
          event:"build_entree_solved",
          page:"03-entree-3",
          entree: ENTREE_TITLE,
          selection:[...selected],
          ts:new Date().toISOString()
        });

        triggerRelay3WithRetry().finally(() => setTimeout(goNext, NAV_DELAY_MS));
      } else {
        locked = true;
        setStatus("Incorrect. Start over.", "err");

        setTimeout(()=>{
          clearAll();
          locked = false;
          setStatus("Select 5 ingredients.");
        }, 450);
      }
    }
  }

  shuffle([...INGREDIENTS]).forEach(label => {
    const b = document.createElement("button");
    b.className = "ingBtn";
    b.type = "button";
    b.textContent = label;
    b.onpointerdown = e => { e.preventDefault(); toggle(label, b); };
    gridEl.appendChild(b);
  });

  document.addEventListener("dblclick", e => e.preventDefault());
})();
</script>
<script>
(() => {
  document.addEventListener("gesturestart", e => e.preventDefault(), { passive: false });
  document.addEventListener("gesturechange", e => e.preventDefault(), { passive: false });
  document.addEventListener("gestureend", e => e.preventDefault(), { passive: false });

  let lastTouchEnd = 0;
  document.addEventListener("touchend", e => {
    const now = Date.now();
    if(now - lastTouchEnd < 350){
      e.preventDefault();
    }
    lastTouchEnd = now;
  }, { passive: false });

  document.addEventListener("touchmove", e => {
    if(e.touches && e.touches.length > 1){
      e.preventDefault();
    }
  }, { passive: false });
})();
</script>
</body>
</html>







